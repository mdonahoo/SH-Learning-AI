{
  "name": "SH-Learning-AI Dev Container", 
  "build": {
    "dockerfile": "Dockerfile",
    "context": ".."
  },
  
  "features": {
    "ghcr.io/devcontainers/features/python:1": {
      "version": "3.11"
    },
    "ghcr.io/devcontainers/features/node:1": {
      "version": "lts"  
    },
    "ghcr.io/devcontainers/features/common-utils:2": {
      "installZsh": true,
      "configureZshAsDefaultShell": true,
      "username": "vscode",
      "userUid": "1000",
      "userGid": "1000"
    }
  },

  "customizations": {
    "vscode": {
      "extensions": [
        "ms-python.python",
        "ms-python.vscode-pylance",
        "ms-toolsai.jupyter"
      ]
    }
  },

  "runArgs": [
    "--group-add", "audio",
    "--cap-add", "SYS_ADMIN", 
    "--cap-add", "SYS_NICE",
    "--security-opt", "apparmor=unconfined",
    "--device", "/dev/snd",
    "--device", "/dev/dsp",
    "--device", "/dev/mixer",
    "--device=/dev/ttyUSB0:/dev/ttyUSB0",
    "--ipc=host",
    "--privileged",
    "--gpus=all"
  ],

  "mounts": [
    "source=\\\\wsl.localhost\\Ubuntu-22.04\\mnt\\wslg,target=/mnt/wslg,type=bind,bind-propagation=rshared",
    "source=\\\\wsl.localhost\\Ubuntu-22.04\\run\\user\\1000\\pulse,target=/run/user/1000/pulse,type=bind,consistency=cached", 
    "source=\\\\wsl.localhost\\Ubuntu-22.04\\tmp\\.X11-unix,target=/tmp/.X11-unix,type=bind,consistency=cached"
  ],

  "containerEnv": {
    "PYTHONPATH": "/workspaces/SH-Learning-AI",
    "PULSE_RUNTIME_PATH": "/mnt/wslg/runtime-dir/pulse",
    "PULSE_SERVER": "unix:/mnt/wslg/runtime-dir/pulse/native",
    "DISPLAY": ":0",
    "WAYLAND_DISPLAY": "wayland-0",
    "XDG_RUNTIME_DIR": "/mnt/wslg/runtime-dir",
    "ALSA_CARD": "0",
    "SDL_AUDIODRIVER": "pulse",
    "AUDIODEV": "hw:0,0",
    "PULSE_LATENCY_MSEC": "30",
    "NVIDIA_VISIBLE_DEVICES": "all",
    "NVIDIA_DRIVER_CAPABILITIES": "all",
    "OLLAMA_MODELS": "/workspaces/SH-Learning-AI/.ollama/models"
  },

  "remoteUser": "vscode",
  "workspaceFolder": "/workspaces/SH-Learning-AI",

  "postCreateCommand": "sudo apt-get update && sudo apt-get install -y alsa-utils pulseaudio-utils libusb-1.0-0 && sudo usermod -a -G dialout vscode && pip install --upgrade pip && curl -fsSL https://ollama.com/install.sh | sh && curl -fsSL https://claude.ai/install.sh | bash",

  "postStartCommand": "sudo chown -R vscode:vscode /workspaces/SH-Learning-AI && sudo find /workspaces/SH-Learning-AI -type d -exec chmod 755 {} \\; && sudo find /workspaces/SH-Learning-AI -type f ! -name '*.sh' -exec chmod 644 {} \\; && sudo find /workspaces/SH-Learning-AI -type f -name '*.sh' -exec chmod +x {} \\;",

  "forwardPorts": [
    8888,     // Jupyter
    11434,    // Ollama
    1864,     // Starship Horizons HTTP API
    1865,     // Starship Horizons WebSocket
    1866,     // Starship Horizons HTTPS API
    1867,     // Starship Horizons Secure WebSocket
    1883      // MQTT Broker
  ]
}